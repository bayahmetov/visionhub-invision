# DataHub - Техническое описание решения

## 📋 Общая информация

**Название проекта:** DataHub  
**Тип:** Веб-платформа для планирования образовательной траектории  
**Целевая аудитория:** Абитуриенты Казахстана  
**Языки интерфейса:** Русский, Казахский, Английский  

---

## 🎯 Проблема и решение

### Проблема
Абитуриенты Казахстана сталкиваются с:
- Разрозненной информацией о вузах и программах
- Сложностью сравнения образовательных учреждений
- Отсутствием персонализированных рекомендаций
- Непониманием карьерных перспектив после обучения

### Решение
DataHub — единая платформа, объединяющая:
- Каталог всех вузов и программ Казахстана
- AI-консультант с персонализированными рекомендациями
- Инструменты сравнения вузов и программ
- Симуляция образовательной траектории (Educational Twin)

---

## 🏗️ Архитектура системы

### Технологический стек

#### Frontend
| Технология | Версия | Назначение |
|------------|--------|------------|
| React | 18.3.1 | UI библиотека |
| TypeScript | 5.x | Типизация |
| Vite | 5.x | Сборщик |
| Tailwind CSS | 3.x | Стилизация |
| React Router | 6.30.1 | Маршрутизация |
| TanStack Query | 5.83.0 | Управление серверным состоянием |
| Shadcn/UI | - | Компонентная библиотека |
| Leaflet | 1.9.4 | Интерактивные карты |
| Recharts | 2.15.4 | Графики и визуализация |
| i18next | 25.7.1 | Интернационализация |

#### Backend (Supabase)
| Компонент | Технология | Назначение |
|-----------|------------|------------|
| База данных | PostgreSQL | Хранение данных |
| Аутентификация | Supabase Auth | Управление пользователями |
| Edge Functions | Deno | Serverless логика |
| Storage | Supabase Storage | Хранение файлов |
| Real-time | Supabase Realtime | Подписки на изменения |

#### AI/ML
| Компонент | Технология | Назначение |
|-----------|------------|------------|
| AI Gateway | Lovable AI Gateway | Проксирование AI запросов |
| LLM | Google Gemini 2.5 Flash | Генерация ответов |
| Модерация | AI Content Moderation | Фильтрация контента |

### Диаграмма архитектуры

```
┌─────────────────────────────────────────────────────────────────┐
│                         FRONTEND                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │   React     │  │  TanStack   │  │   i18next   │              │
│  │ Components  │  │   Query     │  │   (RU/KZ/EN)│              │
│  └──────┬──────┘  └──────┬──────┘  └─────────────┘              │
│         │                │                                       │
│  ┌──────┴────────────────┴──────┐                               │
│  │     Supabase Client SDK      │                               │
│  └──────────────┬───────────────┘                               │
└─────────────────┼───────────────────────────────────────────────┘
                  │ HTTPS
┌─────────────────┼───────────────────────────────────────────────┐
│                 ▼         SUPABASE CLOUD                        │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    API Gateway                           │   │
│  └────────┬────────────────┬────────────────┬──────────────┘   │
│           │                │                │                   │
│  ┌────────▼────────┐ ┌─────▼─────┐ ┌────────▼────────┐         │
│  │   PostgreSQL    │ │   Auth    │ │ Edge Functions  │         │
│  │   Database      │ │  Service  │ │  (Deno Runtime) │         │
│  │                 │ │           │ │                 │         │
│  │ • universities  │ │ • JWT     │ │ • ai-chat       │         │
│  │ • programs      │ │ • OAuth   │ │ • moderate-     │         │
│  │ • profiles      │ │ • Roles   │ │   content       │         │
│  │ • reviews       │ │           │ │                 │         │
│  │ • events        │ └───────────┘ └────────┬────────┘         │
│  │ • cities        │                        │                   │
│  │ • partnerships  │                        │                   │
│  │ • announcements │                        ▼                   │
│  └─────────────────┘               ┌────────────────┐          │
│                                    │ Lovable AI     │          │
│         RLS Policies               │ Gateway        │          │
│         (Row Level Security)       │ (Gemini 2.5)   │          │
│                                    └────────────────┘          │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📊 Модель данных

### Основные сущности

```
┌─────────────────┐       ┌─────────────────┐
│  universities   │       │    programs     │
├─────────────────┤       ├─────────────────┤
│ id (PK)         │◄──────│ university_id   │
│ name_ru/kz/en   │       │ id (PK)         │
│ city            │       │ name_ru/kz/en   │
│ region          │       │ degree_level    │
│ type            │       │ duration_years  │
│ description     │       │ tuition_fee_kzt │
│ logo_url        │       │ ent_min_score   │
│ latitude        │       │ field_id (FK)   │
│ longitude       │       │ grants_available│
│ ranking_national│       └─────────────────┘
│ ranking_qs      │
│ founded_year    │       ┌─────────────────┐
│ students_count  │       │    profiles     │
│ has_dormitory   │       ├─────────────────┤
│ has_grants      │       │ id (PK)         │
│ virtual_tour_url│       │ full_name       │
└─────────────────┘       │ ent_score       │
                          │ expected_ent    │
┌─────────────────┐       │ interests[]     │
│    reviews      │       │ preferred_cities│
├─────────────────┤       │ preferred_fields│
│ id (PK)         │       │ budget_max_kzt  │
│ user_id (FK)    │       │ english_level   │
│ university_id   │       │ target_degree   │
│ rating (1-5)    │       └─────────────────┘
│ comment         │
│ created_at      │       ┌─────────────────┐
└─────────────────┘       │   user_roles    │
                          ├─────────────────┤
┌─────────────────┐       │ id (PK)         │
│ fields_of_study │       │ user_id (FK)    │
├─────────────────┤       │ role (enum)     │
│ id (PK)         │       │ • admin         │
│ name_ru/kz/en   │       │ • student       │
│ icon            │       │ • university    │
└─────────────────┘       └─────────────────┘
```

### Типы данных (Enums)

```typescript
type app_role = "admin" | "student" | "university"
type degree_level = "bachelor" | "master" | "doctorate"  
type university_type = "national" | "state" | "private" | "international"
```

---

## 🔐 Система безопасности

### Row Level Security (RLS)

Все таблицы защищены политиками RLS:

| Таблица | SELECT | INSERT | UPDATE | DELETE |
|---------|--------|--------|--------|--------|
| universities | Все | Admin | Admin/University | Admin |
| programs | Все | Admin/University | Admin/University | Admin |
| profiles | Владелец/Admin | Владелец | Владелец | - |
| reviews | Все | Student/Admin | Владелец | Владелец/Admin |
| user_roles | Admin | Admin | Admin | Admin |

### Аутентификация

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│    Login     │────▶│  Supabase    │────▶│   JWT Token  │
│   (Email/    │     │    Auth      │     │   + Role     │
│   Password)  │     │              │     │   Metadata   │
└──────────────┘     └──────────────┘     └──────────────┘
                            │
                            ▼
                     ┌──────────────┐
                     │  user_roles  │
                     │    table     │
                     │  (role check)│
                     └──────────────┘
```

---

## 🤖 AI-компоненты

### AI-консультант

#### Архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                      ChatWidget                              │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ • Определение контекста страницы                     │   │
│  │ • Сбор профиля пользователя                          │   │
│  │ • Выбор режима AI                                    │   │
│  └──────────────────────┬──────────────────────────────┘   │
└─────────────────────────┼───────────────────────────────────┘
                          │ POST /functions/v1/ai-chat
                          ▼
┌─────────────────────────────────────────────────────────────┐
│                   Edge Function: ai-chat                     │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ • Формирование системного промпта                    │   │
│  │ • Добавление контекста (вуз/программа)               │   │
│  │ • Персонализация по профилю                          │   │
│  └──────────────────────┬──────────────────────────────┘   │
└─────────────────────────┼───────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│              Lovable AI Gateway                              │
│              (Google Gemini 2.5 Flash)                       │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ • Streaming response                                 │   │
│  │ • Multi-language support (RU/KZ/EN)                  │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

#### Режимы работы AI

| Режим | Описание | Контекст |
|-------|----------|----------|
| **Общий** | Общие советы по выбору вуза | Базовая информация |
| **Образовательный близнец** | Симуляция 4-летней траектории | ENT, интересы, бюджет |
| **Альтернативы** | Запасные варианты вузов | Целевой вуз, баллы |
| **Карьера** | Перспективы после окончания | Программа, регион |

#### Контекстная осведомленность

```typescript
// Автоматическое определение контекста страницы
const getPageContext = async () => {
  const path = window.location.pathname;
  
  // Страница вуза: /universities/:id
  if (path.match(/^\/universities\/[a-f0-9-]+$/)) {
    return fetchUniversityContext(universityId);
  }
  
  // Страница программы: /programs/:id
  if (path.match(/^\/programs\/[a-f0-9-]+$/)) {
    return fetchProgramContext(programId);
  }
  
  return null;
};
```

### AI-модерация контента

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  User Review    │────▶│ moderate-content│────▶│  AI Analysis    │
│  Submission     │     │ Edge Function   │     │  (Gemini 2.5)   │
└─────────────────┘     └─────────────────┘     └────────┬────────┘
                                                         │
                                                         ▼
                                               ┌─────────────────┐
                                               │ Moderation      │
                                               │ Decision        │
                                               │ • isAppropriate │
                                               │ • cleanedText   │
                                               │ • reason        │
                                               └─────────────────┘
```

**Фильтруемый контент:**
- Ненормативная лексика (RU/KZ/EN)
- Персональные данные (телефоны, email)
- Ссылки и социальные сети
- Оскорбительный контент

---

## 👥 Ролевая модель

### Роли и возможности

```
┌─────────────────────────────────────────────────────────────┐
│                         ADMIN                                │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ • Полное управление всеми данными                     │  │
│  │ • CRUD для вузов, программ, пользователей             │  │
│  │ • Модерация отзывов                                   │  │
│  │ • Управление заявками на доступ                       │  │
│  │ • Публикация объявлений                               │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                       UNIVERSITY                             │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ • Редактирование данных своего вуза                   │  │
│  │ • Управление программами вуза                         │  │
│  │ • Добавление партнерств                               │  │
│  │ • Публикация объявлений                               │  │
│  │ • Управление мероприятиями                            │  │
│  │ • Загрузка 3D-тура                                    │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                        STUDENT                               │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ • Просмотр каталога вузов и программ                  │  │
│  │ • Добавление в избранное                              │  │
│  │ • Написание отзывов                                   │  │
│  │ • Использование AI-консультанта                       │  │
│  │ • Сравнение вузов и программ                          │  │
│  │ • Заполнение профиля абитуриента                      │  │
│  │ • Запрос доступа к роли университета                  │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### Процесс запроса доступа

```
┌──────────┐    ┌──────────────┐    ┌──────────┐    ┌──────────┐
│ Student  │───▶│ Access       │───▶│  Admin   │───▶│University│
│ Request  │    │ Request Form │    │ Review   │    │  Role    │
└──────────┘    └──────────────┘    └──────────┘    └──────────┘
                     │                    │
                     ▼                    ▼
              ┌──────────────┐    ┌──────────────┐
              │ access_      │    │ Approve/     │
              │ requests     │    │ Reject       │
              │ table        │    │              │
              └──────────────┘    └──────────────┘
```

---

## 🗺️ Маршрутизация

### Публичные маршруты

| Маршрут | Компонент | Описание |
|---------|-----------|----------|
| `/` | Index | Главная страница |
| `/universities` | Universities | Каталог вузов |
| `/universities/:id` | UniversityDetail | Страница вуза |
| `/programs` | Programs | Каталог программ |
| `/programs/:id` | ProgramDetail | Страница программы |
| `/compare` | Compare | Сравнение вузов |
| `/compare-programs` | ComparePrograms | Сравнение программ |
| `/map` | Map | Интерактивная карта |
| `/events` | Events | Календарь событий |
| `/cities` | Cities | Справочник городов |
| `/blog` | Blog | Медиацентр |
| `/blog/:id` | BlogArticle | Статья блога |
| `/about` | About | О проекте |
| `/auth` | Auth | Авторизация |

### Защищенные маршруты

| Маршрут | Роль | Компонент |
|---------|------|-----------|
| `/dashboard` | Student/University | Dashboard |
| `/admin` | Admin | Admin |

---

## 🌍 Интернационализация

### Поддерживаемые языки

```typescript
const languages = {
  ru: "Русский",
  kz: "Қазақша", 
  en: "English"
};
```

### Структура переводов

```
src/i18n/
├── config.ts           # Конфигурация i18next
└── locales/
    ├── ru.json         # Русские переводы
    ├── kz.json         # Казахские переводы
    └── en.json         # Английские переводы
```

### Локализация данных

Все сущности содержат локализованные поля:
```typescript
interface University {
  name_ru: string;
  name_kz: string | null;
  name_en: string | null;
  description_ru: string | null;
  description_kz: string | null;
  description_en: string | null;
  // ...
}
```

---

## 📱 Функциональные возможности

### 1. Каталог вузов
- Фильтрация по региону, типу, направлениям
- Сортировка по рейтингу, названию
- Поиск по названию
- Карточки с ключевой информацией

### 2. Каталог программ
- Фильтрация по уровню, направлению, вузу
- Фильтр по стоимости и проходному баллу
- Поиск по названию программы

### 3. Сравнение
- До 4 вузов одновременно
- До 4 программ одновременно
- Таблица сравнения параметров

### 4. Интерактивная карта
- Все вузы на карте Казахстана
- Кластеризация маркеров
- Popup с информацией о вузе

### 5. AI-консультант
- 4 режима работы
- Контекстная осведомленность
- Персонализированные рекомендации
- Поддержка 3 языков

### 6. Личный кабинет студента
- Профиль абитуриента
- Избранные вузы
- Мои отзывы
- Дорожная карта поступления
- Документы

### 7. Кабинет университета
- Редактирование профиля вуза
- Управление программами
- Партнерства
- Мероприятия
- Объявления

### 8. Админ-панель
- Управление вузами
- Управление программами
- Модерация отзывов
- Управление пользователями
- Заявки на доступ

---

## 🚀 Развертывание

### Инфраструктура

```
┌─────────────────────────────────────────────────────────────┐
│                     Lovable Platform                         │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              Frontend Hosting                        │   │
│  │              (Vite Build + CDN)                      │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│                    Supabase Cloud                            │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │  Database   │  │    Auth     │  │   Edge      │         │
│  │  (Postgres) │  │   Service   │  │  Functions  │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────┘
```

### CI/CD

- Автоматический деплой при изменении кода
- Edge Functions деплоятся автоматически
- Миграции БД применяются через Supabase Dashboard

---

## 📈 Метрики и аналитика

### Отслеживаемые метрики

| Метрика | Таблица | Описание |
|---------|---------|----------|
| Просмотры вузов | university_views | Трекинг просмотров |
| Просмотры статей | articles.views_count | Счетчик просмотров |
| Активность пользователей | profiles.updated_at | Последняя активность |

---

## 🔮 Планы развития

### Phase 3 (Future)
- [ ] Интеграция с НОБ (Национальный образовательный портал)
- [ ] Мобильное приложение (React Native)
- [ ] Расширенная аналитика для вузов
- [ ] Интеграция с системами приема документов
- [ ] Рекомендательная система на основе ML

---

## 📞 Контакты

**Команда разработки:** inVision
**Разрабатываемый проект:** DataHub ВУЗов РК
**Хакатон:** IT Fest 2025  
**Дата:** 2025

---

*Документ создан автоматически на основе кодовой базы проекта DataHub*
